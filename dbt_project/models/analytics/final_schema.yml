version: 2

sources:
 - name: analytics_db # required
   description: 'A data source used for analytics'
   database: Carmen_db
   schema: public
   tables:
     - name: stg_agent #required
       description: 'Normalized table for agents'
       columns:
         - name: agent  # required
         - name: date_agent# required
         - name:  city_agent # required
         - name:  agentid # required
           tests:
             - dbt_constraints.primary_key
         - name:  suspectid # required
           tests:
             - dbt_constraints.foreign_key:
                 pk_table_name: ref('stg_suspect')
                 pk_column_name: suspectid
         - name:  witnessid # required
           tests:
             - dbt_constraints.foreign_key:
                 pk_table_name: ref('stg_witness')
                 pk_column_name: witnessid


     - name: stg_witness # declare properties of additional source tables
       description: 'Normalized table for witness'
       columns:
         - name: witnessid # required
           tests:
             - dbt_constraints.primary_key
         - name: witness # required
         - name:  date_witness # required
         - name:  longitude # required
         - name:  latitude # required
         - name:   suspectid # required
           tests:
             - dbt_constraints.foreign_key:
                 pk_table_name: ref('stg_suspect')
                 pk_column_name: suspectid
         - name: agentid # required
           tests:
             - dbt_constraints.foreign_key:
                 pk_table_name: ref('stg_agent')
                 pk_column_name: agentid
     - name:  stg_suspect # declare properties of additional source tables
       description: 'Normalized table for suspect'

       columns:
         - name:  suspectid # required
           tests:
             - dbt_constraints.primary_key
         - name:  country # required
         - name: city # required
         - name: has_weapon # required
         - name:  has_hat # required
         - name:  has_jacket # required
         - name:  behavior # required
         - name: agentid # required
           tests:
             - dbt_constraints.foreign_key:
                 pk_table_name: ref('stg_agent')
                 pk_column_name: agentid
         - name: witnessid # required
           tests:
             - dbt_constraints.foreign_key:
                 pk_table_name: ref('stg_witness')
                 pk_column_name: witnessid



